┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              BackgroundAgentManager                                │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   TaskRegistry  │  │ SchedulerBackend│  │  MemoryRouter   │  │  EventRouter    │ │
│  │                 │  │   (APScheduler) │  │                 │  │                 │ │
│  │ • Task Configs  │  │ • Interval Mgmt │  │ • Memory Stores │  │ • Event Stores  │ │
│  │ • Validation    │  │ • Job Scheduling│  │ • Context Load  │  │ • Event Stream  │ │
│  │ • Definitions   │  │ • Retry Logic   │  │ • Persistence   │  │ • Real-time     │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              BackgroundOmniAgent(s)                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   MemoryRouter  │  │  ToolRegistry   │  │  EventRouter    │  │  LLM Connection │ │
│  │                 │  │                 │  │                 │  │                 │ │
│  │ • Working Mem   │  │ • Local Tools   │  │ • Task Events   │  │ • OpenAI        │ │
│  │ • Episodic Mem  │  │ • MCP Tools     │  │ • Status Events │  │ • Anthropic     │ │
│  │ • Long-term Mem │  │ • Tool Loading  │  │ • Error Events  │  │ • Google        │ │
│  │ • Vector Search │  │ • Execution     │  │ • Stream Events │  │ • Custom LLMs   │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              Storage & External Layer                               │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   Memory Stores │  │  Event Stores   │  │   Vector DBs    │  │   External      │ │
│  │                 │  │                 │  │                 │  │   Services      │ │
│  │ • In-Memory     │  │ • In-Memory     │  │ • Qdrant        │  │ • Redis         │ │
│  │ • Redis         │  │ • Redis Streams │  │ • ChromaDB      │  │ • PostgreSQL    │ │
│  │ • Database      │  │ • Custom        │  │ • Local Files   │  │ • MongoDB       │ │
│  │ • Qdrant        │  │ • Extensible    │  │ • Embeddings    │  │ • Message Queues│ │
│  │ • ChromaDB      │  │                 │  │ • Semantic      │  │ • APIs          │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              Agent Lifecycle Flow                                   │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Create    │───▶│   Schedule  │───▶│   Execute   │───▶│   Monitor   │
│   Agent     │    │   Task      │    │   Task      │    │   Status    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ • Config    │    │ • Interval  │    │ • Load Mem  │    │ • Events    │
│ • Tools     │    │ • Retry     │    │ • Call LLM  │    │ • Metrics   │
│ • Memory    │    │ • Schedule  │    │ • Use Tools │    │ • Status    │
│ • Events    │    │ • Trigger   │    │ • Store     │    │ • Alerts    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              Event Types & Flow                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ BACKGROUND  │───▶│ BACKGROUND  │───▶│ BACKGROUND  │───▶│ BACKGROUND  │
│ TASK_STARTED│    │ AGENT_STATUS│    │ TASK_COMPLETE│   │ TASK_ERROR  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ • Agent ID  │    │ • Status    │    │ • Result    │    │ • Error     │
│ • Session   │    │ • Timestamp │    │ • Run Count │    │ • Retry     │
│ • Timestamp │    │ • Run Count │    │ • Memory    │    │ • Count     │
│ • Config    │    │ • Last Run  │    │ • Success   │    │ • Details   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              Memory Management                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Working   │    │  Episodic   │    │  Long-term  │    │ Procedural  │
│   Memory    │    │   Memory    │    │   Memory    │    │   Memory    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ • Current   │    │ • Task      │    │ • Knowledge │    │ • Task      │
│ • Session   │    │ • History   │    │ • Base      │    │ • Patterns  │
│ • Context   │    │ • Results   │    │ • Facts     │    │ • Workflows │
│ • State     │    │ • Events    │    │ • Vector    │    │ • Procedures│
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              Tool Integration                                       │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  Local      │    │   MCP       │    │  Custom     │    │  External   │
│  Tools      │    │  Tools      │    │  Tools      │    │  Services   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ • calculate │    │ • filesystem│    │ • User      │    │ • APIs      │
│ • format    │    │ • database  │    │ • Defined   │    │ • Webhooks  │
│ • system    │    │ • search    │    │ • Functions │    │ • Services  │
│ • custom    │    │ • external  │    │ • Classes   │    │ • Integrations│
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              Use Cases & Examples                                   │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   File      │    │   System    │    │   Data      │    │   Content   │
│  Monitor    │    │   Health    │    │ Processor   │    │ Generator   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ • Watch     │    │ • CPU/Mem   │    │ • Analyze   │    │ • Generate  │
│ • Changes   │    │ • Disk      │    │ • Process   │    │ • Content   │
│ • Analyze   │    │ • Processes │    │ • Report    │    │ • Schedule  │
│ • Report    │    │ • Alerts    │    │ • Store     │    │ • Publish   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              Management Interface                                   │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Create    │    │   Update    │    │   Monitor   │    │   Control   │
│   Agent     │    │   Config    │    │   Status    │    │   Agents    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ • Config    │    │ • Interval  │    │ • Running   │    │ • Pause     │
│ • Tools     │    │ • Retry     │    │ • Errors    │    │ • Resume    │
│ • Memory    │    │ • Tasks     │    │ • Metrics   │    │ • Stop      │
│ • Schedule  │    │ • Settings  │    │ • Events    │    │ • Delete    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘ 